var PH_INAPP_HOST="https://inapp.planhat.com";var plantrack=function(e,t){var n,r=!0,i=window,o=document.location,defaults={api_host:"http://"+o.hostname+o.pathname,track_links_timeout:300,cookie_name:"_plantrack",cookie_expiration:365,cookie_domain:(n=o.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i))?n[0]:"",inapp_host:PH_INAPP_HOST||"https://inapp.planhat.com",tenant_token:"",prev_url:o.pathname,inAppInProgress:false};Date.prototype.toISOString||function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}();Array.prototype.forEach||(Array.prototype.forEach=function(e,t){"use strict";var n,r;for(n=0,r=this.length;r>n;++n)n in this&&e.call(t,this[n],n,this)});var cookieJar={getItem:function(e){var planhatCookie=document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+e+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1");return decodeURIComponent(planhatCookie)||null},setItem:function(e,t,n,r,i,o){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var a="";if(n){switch(n.constructor){case Number:a=1/0===n?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:a="; expires="+n;break;case Date:a="; expires="+n.toGMTString()}}if(o&&document.location.protocol!=="https:")o=false;return document.cookie=escape(e)+"="+escape(t)+a+(i?"; domain="+i:"")+(r?"; path="+r:"")+(o?"; secure; SameSite=Strict":""),!0},removeItem:function(e,t){return e&&this.hasItem(e)?(document.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; path="+t:""),!0):!1},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}};var getCookieObj=function(){var e,t={};if(e=cookieJar.getItem(defaults.cookie_name)){try{t=JSON.parse(decodeURIComponent(e))}catch(n){}}return t};var writeCookie=function(e){cookieJar.setItem(defaults.cookie_name,i.encodeURIComponent(JSON.stringify(e)),3600*24*defaults.cookie_expiration,"/",defaults.cookie_domain,true)};var replaceTemplateCodes=function(template,replaceData){var result=template;var rKeys=Object.keys(replaceData);for(var i=0;i<rKeys.length;i++){result=result.replace("%"+rKeys[i]+"%",replaceData[rKeys[i]])}return result};var getPageTemplate=function(page,value){if(!page.template||!page.values)return page.template||page;var replaceData=page.values[value]||page.values[0];var template=page.template;return replaceTemplateCodes(template,replaceData)};e.init=function(overload){for(var key in overload){var value=overload[key];if(value!==t){defaults[key]=overload[key]}}defaults.api_host=defaults.api_host.replace("/$","");defaults.tenant_token=/[^/]*$/.exec(defaults.api_host)[0];return e};e.track=function(action,extras){extras=extras||{};var cookie=getCookieObj();if(cookie)for(var key in cookie)extras[key]=cookie[key];var p={e:action,kv:extras};var url=defaults.api_host+"?data="+i.encodeURIComponent(JSON.stringify(p));var h=new XMLHttpRequest;h.open("GET",url,r);h.withCredentials=false;h.send(null);return e};e.identify=function(id,options){var cookie={};if(id)cookie.id=id;if(options){for(var o in options)cookie[o]=options[o]}writeCookie(cookie);e.checkInAppMessage();return e};e.checkInAppMessage=function(){if(defaults.inAppInProgress)return;if(localStorage){var inappTimeout=localStorage.getItem("inappTimeout");if(inappTimeout&&inappTimeout>+new Date)return}defaults.inAppInProgress=true;var user=getCookieObj();var url=defaults.inapp_host+"/msg/"+defaults.tenant_token;var h=new XMLHttpRequest;h.open("POST",url,r);h.setRequestHeader("Content-Type","application/json");h.withCredentials=false;h.send(JSON.stringify(user));h.onreadystatechange=function(){if(h.readyState!==4)return;if(localStorage){localStorage.setItem("inappTimeout",5*60*1e3+ +new Date)}if(h.status===200&&h.responseText.length){var response=JSON.parse(h.responseText);if(response&&response.content){var content=response.content;var id=response.id;var formData={};var step=1;var isSubmited=false;var elem=document.createElement("div");elem.innerHTML=content.step1;elem.addEventListener("click",function(event){var dataset=event.target.dataset;var form=event.target.closest("form");if(form){Object.values(form).forEach(function(field){switch(field.type){case"radio":case"checkbox":if(field.checked)formData[field.name]=field.value;break;default:if(field.name)formData[field.name]=field.value}});var textareaList=form.getElementsByTagName("textarea");for(var i=0;i<textareaList.length;i++){var field=textareaList[i];if(field.name)formData[field.name]=field.value}}if(dataset.nextstep||undefined){step++;var page=content["step"+step];if(page){elem.innerHTML=getPageTemplate(page,dataset.value)}}if(dataset.submit||undefined){var page=content.lastPage;if(page){elem.innerHTML=getPageTemplate(page,dataset.value)}else{elem.remove()}if(!isSubmited){isSubmited=true;e.sendInAppResponse(id,formData);defaults.inAppInProgress=false}}if(dataset.exit||undefined){if(step>1&&!isSubmited){isSubmited=true;e.sendInAppResponse(id,formData);defaults.inAppInProgress=false}e.closeInApp(id,elem)}if(dataset.unsubscribe||undefined){e.unsubscribeInApp(id,elem)}});setTimeout(function(){document.body.appendChild(elem)},200)}}else{defaults.inAppInProgress=false}}};e.sendInAppResponse=function(id,data){var url=defaults.inapp_host+"/msg/response/"+defaults.tenant_token+"/"+id;var h=new XMLHttpRequest;h.open("POST",url,r);h.setRequestHeader("Content-Type","application/json");h.withCredentials=false;h.send(JSON.stringify(data))};e.unsubscribeInApp=function(id,elem){var url=defaults.inapp_host+"/msg/unsubscribe/"+defaults.tenant_token+"/"+id;var h=new XMLHttpRequest;h.open("GET",url,r);h.setRequestHeader("Content-Type","application/json");h.withCredentials=false;h.send();h.onreadystatechange=function(){if(h.readyState!==4)return;elem.remove();defaults.inAppInProgress=false}};e.closeInApp=function(id,elem){var url=defaults.inapp_host+"/msg/close/"+defaults.tenant_token+"/"+id;var h=new XMLHttpRequest;h.open("GET",url,r);h.setRequestHeader("Content-Type","application/json");h.withCredentials=false;h.send();h.onreadystatechange=function(){if(h.readyState!==4)return;elem.remove();defaults.inAppInProgress=false}};e._endpoint?e.init({api_host:e._endpoint}):console.error("[plantrack] You must set your collector endpoint via plantrack.load(endpoint) in the Analytics JS snippet");var w="",b=e.length;for(var T=0;b>T;T++){w=e[T][0];e[w].apply(null,e[T].slice(1))}setInterval(function(){if(o.pathname!==defaults.prev_url){defaults.prev_url=o.pathname;e.checkInAppMessage()}},10);return e.splice(0,b),e}(plantrack||[]);